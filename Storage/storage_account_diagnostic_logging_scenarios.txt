### Testing Azure storage logging based on https://learn.microsoft.com/en-us/azure/storage/blobs/monitor-blob-storage?tabs=azure-portal

## 1.1 Valid MSFT ENTRA request via OAUTH- 200 ##
URL: https://testrbbicep123.blob.core.windows.net/testrb/kpi_overzicht.csv (oauth token in auth header)
Actie: File downloaded
Logging: { "time": "2025-07-22T13:40:54.9565596Z", "resourceId": "/subscriptions/37706cf5-5fe6-4528-9c30-4560d04e81ab/resourceGroups/test-bicep-rg/providers/Microsoft.Storage/storageAccounts/testrbbicep123/blobServices/default", "category": "StorageRead", "operationName": "BlobPreflightRequest", "operationVersion": "2015-02-21", "schemaVersion": "1.0", "statusCode": 200, "statusText": "Success", "durationMs": 0, "callerIpAddress": "185.113.53.72:64331", "correlationId": "d7ff2259-901e-003a-270e-fb468f000000", "identity": {"type":"AnonymousPreflight"}, "location": "eastus", "properties": {"accountName":"testrbbicep123","userAgentHeader":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:140.0) Gecko/20100101 Firefox/140.0","referrerHeader":"https://portal.azure.com/","serviceType":"blob","objectKey":"/testrbbicep123/testrb/kpi_overzicht.csv","metricResponseType":"Success","requestHeaderSize":614,"responseHeaderSize":381,"tlsVersion":"TLS 1.3","sourceAccessTier":"Invalid"}, "uri": "https://testrbbicep123.blob.core.windows.net:443/testrb/kpi_overzicht.csv?_=1753191649348", "protocol": "HTTPS", "resourceType": "Microsoft.Storage/storageAccounts/blobServices"}

## 1.2. Valid SAS token - 200 ##
URL: https://testrbbicep123.blob.core.windows.net/testrb/kpi_overzicht.csv?sp=r&st=2025-07-22T12:03:31Z&se=2025-07-22T20:18:31Z&spr=https&sv=2024-11-04&sr=b&sig=Pv6B3nKG%2B5011LBgy1C0rFKMYt1VJWojc4eQintNqvk%3D
Actie: File downloaded
Logging: { "time": "2025-07-22T12:41:50.9498714Z", "resourceId": "/subscriptions/37706cf5-5fe6-4528-9c30-4560d04e81ab/resourceGroups/test-bicep-rg/providers/Microsoft.Storage/storageAccounts/testrbbicep123/blobServices/default", "category": "StorageRead", "operationName": "GetBlob", "operationVersion": "2024-11-04", "schemaVersion": "1.0", "statusCode": 200, "statusText": "Success", "durationMs": 8, "callerIpAddress": "185.113.53.72:63552", "correlationId": "6dbda3ca-f01e-0013-6e05-fb78fb000000", "identity": {"type":"SAS","tokenHash":"key1(2ED25B749407949B184F1E44A75391657636D7C0AC64A406D4C582C4B4717279),SasSignature(BE93749BE44D07DA8930487E45C26175AB95B8BE8B3056D38A05F5420931D539)"}, "location": "eastus", "properties": {"accountName":"testrbbicep123","userAgentHeader":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36","etag":"\"0x8DDC9173232855F\"","serviceType":"blob","objectKey":"/testrbbicep123/testrb/kpi_overzicht.csv","lastModifiedTime":"7/22/2025 11:59:22 AM","metricResponseType":"Success","serverLatencyMs":8,"requestHeaderSize":845,"responseHeaderSize":417,"responseBodySize":277,"tlsVersion":"TLS 1.3","sourceAccessTier":"Invalid"}, "uri": "https://testrbbicep123.blob.core.windows.net:443/testrb/kpi_overzicht.csv?sp=r&st=2025-07-22T12:03:31Z&se=2025-07-22T20:18:31Z&spr=https&sv=2024-11-04&sr=b&sig=XXXXX", "protocol": "HTTPS", "resourceType": "Microsoft.Storage/storageAccounts/blobServices"}

## 2.1 Invalid MSFT ENTRA request via OAUTH- 403 ##
URL: https://testrbbicep123.blob.core.windows.net/testrb/kpi_overzicht.csv
Actie: You do not have permissions to list the data using your user account with Microsoft Entra ID. 
Logging: { "time": "2025-07-22T13:51:01.8878614Z", "resourceId": "/subscriptions/37706cf5-5fe6-4528-9c30-4560d04e81ab/resourceGroups/test-bicep-rg/providers/Microsoft.Storage/storageAccounts/testrbbicep123/blobServices/default", "category": "StorageRead", "operationName": "ListBlobs", "operationVersion": "2024-11-04", "schemaVersion": "1.0", "statusCode": 403, "statusText": "AuthorizationPermissionMismatch", "durationMs": 417, "callerIpAddress": "185.113.53.72:64492", "correlationId": "de2a6fef-601e-0073-3f0f-fb0464000000", "identity": {"type":"OAuth","tokenHash":"883AAE4EB3181E39D6CEA728D4B96355A4F82DA7458B2041A225466A15689E21","authorization":[{"action":"Microsoft.Storage/storageAccounts/blobServices/containers/blobs/read", "roleAssignmentId":"", "roleDefinitionId":"", "principals": [], "denyAssignmentId":"", "type":"RBAC", "result":"Denied", "reason":"NoApplicablePolicy"},{"purview": [{"request.azure.dataaction": "Microsoft.Storage/storageAccounts/blobServices/containers/blobs/read", "resource.azure.path": "/subscriptions/37706cf5-5fe6-4528-9c30-4560d04e81ab/resourceGroups/test-bicep-rg/providers/Microsoft.Storage/storageAccounts/testrbbicep123/blobServices/default/containers/testrb", "principal.microsoft.id": "0713a87c-a777-4644-a8bf-90dc60bf4b62", "permissions": ["Microsoft.Storage/storageAccounts/blobServices/containers/blobs/read"]}]}],"requester":{"appId":"691458b9-1327-4635-9f55-ed83a7f1b41c","audience":"https://storage.azure.com/","objectId":"0713a87c-a777-4644-a8bf-90dc60bf4b62","tenantId":"594ef155-b5f1-4381-9218-2ea93f0645f2","tokenIssuer":"https://sts.windows.net/594ef155-b5f1-4381-9218-2ea93f0645f2/","upn":"bremerov@testaadrbr.onmicrosoft.com"}}, "location": "eastus", "properties": {"accountName":"testrbbicep123","userAgentHeader":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:140.0) Gecko/20100101 Firefox/140.0","referrerHeader":"https://portal.azure.com/","serviceType":"blob","objectKey":"/testrbbicep123/testrb","metricResponseType":"AuthorizationError","serverLatencyMs":417,"requestHeaderSize":2757,"responseHeaderSize":337,"responseBodySize":279,"tlsVersion":"TLS 1.3","sourceAccessTier":"Invalid"}, "uri": "https://testrbbicep123.blob.core.windows.net:443/testrb?restype=container&comp=list&prefix=&delimiter=%2F&include=metadata", "protocol": "HTTPS", "resourceType": "Microsoft.Storage/storageAccounts/blobServices"}

## 2.2 Invalid SAS token - 409 ##
URL: https://testrbbicep123.blob.core.windows.net/testrb/kpi_overzicht.csv?sp=r&st=2025-07-22T12:03:31Z&se=2025-07-22T20:18:31Z&spr=https&sv=2024-11-04&sr=b&sig=Qv6B3nKG%2B5011LBgy1C0rFKMYt1VJWojc4eQintNqvk%3D
Actie: <Error><Code>AuthenticationFailed</Code><Message>Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature. RequestId:944d0d41-d01e-0014-470d-fb1498000000 Time:2025-07-22T13:35:12.3927638Z</Message><AuthenticationErrorDetail>Signature fields not well formed.</AuthenticationErrorDetail></Error>
Logging: { "time": "2025-07-22T12:25:27.7551081Z", "resourceId": "/subscriptions/37706cf5-5fe6-4528-9c30-4560d04e81ab/resourceGroups/test-bicep-rg/providers/Microsoft.Storage/storageAccounts/testrbbicep123/blobServices/default", "category": "StorageRead", "operationName": "GetBlob", "operationVersion": "2008-10-27", "schemaVersion": "1.0", "statusCode": 409, "statusText": "UnknownError", "durationMs": 4, "callerIpAddress": "185.113.53.72:63307", "correlationId": "d700d3f9-d01e-0004-4703-fbd1f0000000", "identity": {"type":"Anonymous"}, "location": "eastus", "properties": {"accountName":"testrbbicep123","userAgentHeader":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36","referrerHeader":"https://testrbbicep123.blob.core.windows.net/testrb/kpi_overzicht.csv?sp=r&st=2025-07-22T12:03:31Z&se=2025-07-22T20:18:31Z&spr=https&sv=2024-11-04&sr=b&sig=Qv6B3nKG%2B5011LBgy1C0rFKMYt1VJWojc4eQintNqvk%3D","serviceType":"blob","objectKey":"/testrbbicep123/$root/favicon.ico","metricResponseType":"ClientOtherError","serverLatencyMs":3,"requestHeaderSize":798,"responseHeaderSize":125,"responseBodySize":248,"tlsVersion":"TLS 1.3","sourceAccessTier":"Invalid"}, "uri": "https://testrbbicep123.blob.core.windows.net:443/favicon.ico", "protocol": "HTTPS", "resourceType": "Microsoft.Storage/storageAccounts/blobServices"}

## 3. geen SAS token - 409 ##
URL: https://testrbbicep123.blob.core.windows.net/testrb/kpi_overzicht.csv
Actie: <Error><Code>PublicAccessNotPermitted</Code><Message>Public access is not permitted on this storage account. RequestId:6dbe300d-f01e-0013-1306-fb78fb000000 Time:2025-07-22T12:43:37.7866034Z</Message></Error>
Logging: { "time": "2025-07-22T13:29:42.6330103Z", "resourceId": "/subscriptions/37706cf5-5fe6-4528-9c30-4560d04e81ab/resourceGroups/test-bicep-rg/providers/Microsoft.Storage/storageAccounts/testrbbicep123/blobServices/default", "category": "StorageRead", "operationName": "GetBlob", "operationVersion": "2008-10-27", "schemaVersion": "1.0", "statusCode": 409, "statusText": "UnknownError", "durationMs": 3, "callerIpAddress": "185.113.53.72:64225", "correlationId": "5e093711-201e-003f-790c-fb9454000000", "identity": {"type":"Anonymous"}, "location": "eastus", "properties": {"accountName":"testrbbicep123","userAgentHeader":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36","serviceType":"blob","objectKey":"/testrbbicep123/testrb/kpi_overzicht.csv","metricResponseType":"ClientOtherError","serverLatencyMs":3,"requestHeaderSize":710,"responseHeaderSize":125,"responseBodySize":248,"tlsVersion":"TLS 1.3","sourceAccessTier":"Invalid"}, "uri": "https://testrbbicep123.blob.core.windows.net:443/testrb/kpi_overzicht.csv", "protocol": "HTTPS", "resourceType": "Microsoft.Storage/storageAccounts/blobServices"}

## 4. Firewall blockt request - 403 ##
URL: https://testrbbicep123.blob.core.windows.net/testrb/kpi_overzicht.csv
Actie: <Error><Code>AuthorizationFailure</Code><Message>This request is not authorized to perform this operation. RequestId:060e22dd-001e-005a-2308-fb3a10000000 Time:2025-07-22T13:01:11.1957668Z</Message></Error>
Logging: { "time": "2025-07-22T13:10:54.6710368Z", "resourceId": "/subscriptions/37706cf5-5fe6-4528-9c30-4560d04e81ab/resourceGroups/test-bicep-rg/providers/Microsoft.Storage/storageAccounts/testrbbicep123/blobServices/default", "category": "StorageRead", "operationName": "GetBlob", "operationVersion": "2008-10-27", "schemaVersion": "1.0", "statusCode": 403, "statusText": "AuthorizationFailure", "durationMs": 4, "callerIpAddress": "185.113.53.72:63908", "correlationId": "de1e61a6-601e-0073-050a-fb0464000000", "identity": {"type":"Anonymous"}, "location": "eastus", "properties": {"accountName":"testrbbicep123","userAgentHeader":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36","referrerHeader":"https://testrbbicep123.blob.core.windows.net/testrb/kpi_overzicht.csv?sp=r&st=2025-07-22T12:03:31Z&se=2025-07-22T20:18:31Z&spr=https&sv=2024-11-04&sr=b&sig=Pv6B3nKG%2B5011LBgy1C0rFKMYt1VJWojc4eQintNqvk%3D","serviceType":"blob","objectKey":"/","metricResponseType":"AuthorizationError","serverLatencyMs":4,"requestHeaderSize":798,"responseHeaderSize":95,"responseBodySize":246,"tlsVersion":"TLS 1.3","sourceAccessTier":"Invalid"}, "uri": "https://testrbbicep123.blob.core.windows.net:443/favicon.ico", "protocol": "HTTPS", "resourceType": "Microsoft.Storage/storageAccounts/blobServices"}
